<html>
	<head>
		<title>
			Carworkz Help Chat
		</title>
		<style type="text/css">
			#cw-chat {
				height: 300px;
			}
			#cw-msg-wrapper {
				float:left;
				border: 1px #000 solid;
			}
			#cw-chat-wrapper {
				display: none;
			}
			.error {
				color: red;
			}
			.priv {
				color: gray;
			}
		</style>
	</head>
	<body>
		<div id="cw-user-check-frm">
			<p>Enter a Username: </p>
			<p id="cw-user-error"></p>
			<form id="cw-check-user">
				<input type="text" size="30" id="username" />
				<input type="submit" />
			</form>
		</div>

		<div id="cw-chat-wrapper">
			<div id="cw-msg-wrapper">
				<input type="text" id="cw-user-name" value="" />
				<div id="cw-chat"></div>
				<form id="cw-send-msg">
					<textarea id="cw-message"></textarea>
					<br/>
					<input type="submit" value="Send" />
				</form>
			</div>
			<div id="cw-users"></div>
		</div>
		<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
		<script type="text/javascript">
			$(document).ready(function() {
				var socket = io.connect();
				var $messageForm = $('#cw-send-msg');
				var $messagegBox = $('#cw-message');
				var $chatBox 	 = $('#cw-chat');
				var $userChkForm = $('#cw-check-user');
				var $userError   = $('#cw-user-error');
				var $userName  	 = $('#username');
				var $cwUserName  = $('#cw-user-name');
				var $cwUserFrm 	 = $('#cw-user-check-frm');
				var $cwUsers 	 = $('#cw-users');

				$userChkForm.submit(function(e) {
					e.preventDefault();
					var currentUser = $userName.val();
					socket.emit('new user', $userName.val(), function(data) {
						if (data) {
							$cwUserFrm.hide();
							$('#cw-chat-wrapper').show();
							$cwUserName.val(currentUser);
						} else {
							$userError.html("Oops! Username you are trying is already taken, Try again!");
						}
					});
					$userName.val('');
				});

				$messageForm.submit(function(e) {
					e.preventDefault();
					socket.emit('send message', $messagegBox.val(), function(data) {
						$chatBox.append('<span class="error">' + data + '</span><br/>');
					});
					$messagegBox.val('');
				});

				/*Receive message client side*/
				socket.on('new message', function(data) {
					$chatBox.append('<b>' + data.user + ': </b>' + data.msg + '<br/>');
				});

				socket.on('private', function(data) {
					$chatBox.append('<span class="priv"><b>' + data.user + ': </b>' + data.msg + '</span><br/>');
				});

				socket.on('usernames', function(data) {
					var htmlStr = '';
					for (var i = 0; i < data.length; i++) {
						htmlStr += data[i] + "<br />";
					}
					$cwUsers.html(htmlStr);
				});
			});





			/*$(document).ready(function() {*/
				/*var socket  	 = io.connect();
				var $messageForm = $('#chatMsgForm');
				var $messagegBox = $('#chatMsgBox');
				var $chatBox 	 = $('#chatMsgDisplayBox');
				var $userChkForm = $('#loginForm');
				var $userError   = $('#userError');
				var $userName  	 = $('#username');
				var $cwUserName  = $('#currentUser');
				var $cwUserFrm 	 = $('#loginDiv');
				var $cwUsers 	 = $('#chatActiveUsers');
				var $cwUserId 	 = $('#cwUserId');*/

				/*$userChkForm.submit(function(e) {
					e.preventDefault();
					// var currentUser = $cwUserId.val();
					var currentUser = "Guest";
					socket.emit('Active Users WS support', $cwUserId.val(), function(data) {
						if (data) {
							console.log("New user Opened chat box");
						} else {
							$userError.html("Oops! Username you are trying is already taken, Try again!");
						}
					});
				});*/

				/*$messageForm.submit(function(e) {
					e.preventDefault();
					socket.emit('WS support receive', {"msg": $messagegBox.val(), 
						"userIdFrom": $cwUserId.val(),
						"userIdTo": 'CW-CHAT-ft28UONyXDuHY5ZzVSqwu5adJtaUdsNU'}, function(data) {
						$chatBox.append('<span class="error">' + data + '</span><br/>');
					});
					$messagegBox.val('');
				});*/

				/*Receive message client side*/
				/*socket.on('new message', function(data) {
					$chatBox.append('<b>' + data.user + ': </b>' + data.msg + '<br/>');
				});

				socket.on('WS support send', function(data) {
					console.log(data);
					$chatBox.append('<span class="priv"><b>' + data.user + ': </b>' + data.msg + '</span><br/>');
				});

				socket.on('usernames', function(data) {
					var htmlStr = '';
					for (var i = 0; i < data.length; i++) {
						htmlStr += data[i] + "<br />";
					}
					$cwUsers.html(htmlStr);
				});*/
			/*});*/
		</script>
	</body>
</html>